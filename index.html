<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>iOS WebClip Generator</title>
    <style>
        body {
            background-color: #1c1c1c;
            color: #ffffff;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }

        .container {
            background-color: #2c2c2c;
            padding: 30px;
            border-radius: 16px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        h1 {
            text-align: center;
            font-size: 24px;
            margin-bottom: 25px;
            font-weight: 600;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            color: #b0b0b0;
        }

        input[type="text"],
        input[type="url"],
        input[type="file"] {
            width: 100%;
            padding: 12px;
            background-color: #3a3a3a;
            border: 1px solid #4a4a4a;
            border-radius: 10px;
            color: white;
            font-size: 16px;
            box-sizing: border-box;
            outline: none;
            transition: border-color 0.2s;
        }

        input:focus {
            border-color: #007aff;
        }

        /* Кастомный стиль для инпута файла */
        input[type="file"]::file-selector-button {
            background-color: #4a4a4a;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            margin-right: 10px;
            cursor: pointer;
        }

        button {
            width: 100%;
            padding: 15px;
            background-color: #007aff; /* Apple Blue */
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-top: 10px;
        }

        button:hover {
            background-color: #0056b3;
        }

        .preview {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background: #3a3a3a;
            border-radius: 10px;
        }

        .preview img {
            width: 60px;
            height: 60px;
            border-radius: 14px;
            object-fit: cover;
            margin-right: 15px;
            background-color: #1c1c1c;
        }

        .preview-text h3 {
            margin: 0;
            font-size: 16px;
        }
        
        .preview-text p {
            margin: 4px 0 0 0;
            font-size: 12px;
            color: #888;
        }

        .note {
            margin-top: 20px;
            font-size: 12px;
            color: #666;
            text-align: center;
            line-height: 1.4;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>Создать Web Clip</h1>
    
    <div class="form-group">
        <label for="urlInput">Ссылка запуска (URL)</label>
        <input type="url" id="urlInput" placeholder="https://example.com" required>
    </div>

    <div class="form-group">
        <label for="appNameInput">Название приложения</label>
        <input type="text" id="appNameInput" placeholder="Мое Приложение" required>
    </div>

    <div class="form-group">
        <label for="profileNameInput">Название профиля (в настройках)</label>
        <input type="text" id="profileNameInput" placeholder="Установщик WebApp" required>
    </div>

    <div class="form-group">
        <label for="iconInput">Иконка приложения (PNG/JPG)</label>
        <input type="file" id="iconInput" accept="image/png, image/jpeg">
    </div>

    <div class="preview" id="previewBox" style="display:none;">
        <img id="iconPreview" src="" alt="Icon">
        <div class="preview-text">
            <h3 id="previewAppName">Название</h3>
            <p id="previewUrl">url...</p>
        </div>
    </div>

    <button id="generateBtn">Скачать профиль</button>

    <div class="note">
        После скачивания перейдите в <b>Настройки -> Основные -> VPN и управление устройством</b> для установки профиля.
    </div>
</div>

<script>
    // Генерация UUID для профиля
    function generateUUID() {
        return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0, v = c == 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
        });
    }

    const iconInput = document.getElementById('iconInput');
    const iconPreview = document.getElementById('iconPreview');
    const previewBox = document.getElementById('previewBox');
    const appNameInput = document.getElementById('appNameInput');
    const previewAppName = document.getElementById('previewAppName');
    const urlInput = document.getElementById('urlInput');
    const previewUrl = document.getElementById('previewUrl');

    let iconBase64 = null;

    // Обработка загрузки иконки для превью и конвертации
    iconInput.addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                iconPreview.src = event.target.result;
                // Нам нужна чистая строка base64 без префикса data:image/...
                iconBase64 = event.target.result.split(',')[1]; 
                previewBox.style.display = 'flex';
            };
            reader.readAsDataURL(file);
        }
    });

    // Живое обновление превью
    appNameInput.addEventListener('input', (e) => previewAppName.innerText = e.target.value || 'Название');
    urlInput.addEventListener('input', (e) => previewUrl.innerText = e.target.value || 'url...');

    document.getElementById('generateBtn').addEventListener('click', function() {
        const url = urlInput.value;
        const appName = appNameInput.value;
        const profileName = document.getElementById('profileNameInput').value;

        if (!url || !appName || !profileName) {
            alert('Пожалуйста, заполните все поля');
            return;
        }

        const payloadUUID = generateUUID();
        const contentUUID = generateUUID();

        // XML шаблон профиля
        // Важно: Полноэкранный режим (FullScreen = true) работает только если сайт поддерживает PWA манифест,
        // но сам WebClip попытается убрать интерфейс браузера.
        const xmlContent = `<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE plist PUBLIC "-//Apple//DTD PLIST 1.0//EN" "http://www.apple.com/DTDs/PropertyList-1.0.dtd">
<plist version="1.0">
<dict>
    <key>PayloadContent</key>
    <array>
        <dict>
            <key>FullScreen</key>
            <true/>
            <key>IsRemovable</key>
            <true/>
            <key>Icon</key>
            <data>${iconBase64 || ''}</data>
            <key>Label</key>
            <string>${appName}</string>
            <key>PayloadDescription</key>
            <string>Configures Web Clip</string>
            <key>PayloadDisplayName</key>
            <string>${appName}</string>
            <key>PayloadIdentifier</key>
            <string>com.webclip.${contentUUID}</string>
            <key>PayloadType</key>
            <string>com.apple.webClip.managed</string>
            <key>PayloadUUID</key>
            <string>${contentUUID}</string>
            <key>PayloadVersion</key>
            <integer>1</integer>
            <key>Precomposed</key>
            <true/>
            <key>URL</key>
            <string>${url}</string>
        </dict>
    </array>
    <key>PayloadDisplayName</key>
    <string>${profileName}</string>
    <key>PayloadIdentifier</key>
    <string>com.profile.${payloadUUID}</string>
    <key>PayloadRemovalDisallowed</key>
    <false/>
    <key>PayloadType</key>
    <string>Configuration</string>
    <key>PayloadUUID</key>
    <string>${payloadUUID}</string>
    <key>PayloadVersion</key>
    <integer>1</integer>
</dict>
</plist>`;

        // Создание и скачивание файла
        const blob = new Blob([xmlContent], { type: 'application/x-apple-aspen-config' });
        const link = document.createElement('a');
        link.href = window.URL.createObjectURL(blob);
        link.download = `${appName.replace(/\s+/g, '_')}.mobileconfig`;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    });
</script>

</body>
</html>
